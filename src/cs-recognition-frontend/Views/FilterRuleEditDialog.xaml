<UserControl
    x:Class="Haru.Kei.Views.FilterRuleEditDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:l="http://schemas.livet-mvvm.net/2011/wpf"
    xmlns:ri="clr-namespace:Reactive.Bindings.Interactivity;assembly=ReactiveProperty.WPF"
    xmlns:prism="http://prismlibrary.com/"
    xmlns:local="clr-namespace:Haru.Kei.Views"
    mc:Ignorable="d" 
    d:DesignHeight="450" d:DesignWidth="800">

    <i:Interaction.Triggers>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}" MessageKey="Confirmation" >
            <l:ConfirmationDialogInteractionMessageAction/>
        </l:InteractionMessageTrigger>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}" MessageKey="Information" >
            <l:InformationDialogInteractionMessageAction/>
        </l:InteractionMessageTrigger>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}" MessageKey="OpenFile" >
            <l:OpenFileDialogInteractionMessageAction/>
        </l:InteractionMessageTrigger>
        <l:InteractionMessageTrigger Messenger="{Binding Messenger}" MessageKey="SaveFile" >
            <l:SaveFileDialogInteractionMessageAction/>
        </l:InteractionMessageTrigger>
    </i:Interaction.Triggers>
    <prism:Dialog.WindowStyle>
        <Style TargetType="Window">
            <Setter Property="ResizeMode" Value="NoResize" />
            <Setter Property="ShowInTaskbar" Value="False" />
            <Setter Property="SizeToContent" Value="WidthAndHeight" />
        </Style>
    </prism:Dialog.WindowStyle>
    <Border
        Padding="8"
        Width="420" Height="360"
        Background="White">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="8" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="24" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="8" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="16" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="4" />
                <RowDefinition Height="72" />
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <GroupBox
                Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="0"
                Header="アクション">
                <StackPanel Margin="8">
                    <RadioButton
                    IsChecked="{Binding ActionMaskValue.Value, Mode=TwoWay}"
                    Content="先頭意外マスク"
                    GroupName="a"
                    />
                    <RadioButton
                    IsChecked="{Binding ActionMaskAllValue.Value, Mode=TwoWay}"
                    Content="全部をマスク"
                    GroupName="a"
                    />
                    <RadioButton
                    IsChecked="{Binding ActionReplaceValue.Value, Mode=TwoWay}"
                    Content="置き換え"
                    GroupName="a">
                        <i:Interaction.Triggers>
                            <i:DataTrigger Binding="{Binding ActionReplaceValue.Value}" Comparison="Equal" Value="true">
                                <i:ChangePropertyAction TargetName="dstReplace" PropertyName="Visibility" Value="Visible" />
                                <i:ChangePropertyAction TargetName="dstMask" PropertyName="Visibility" Value="Hidden" />
                            </i:DataTrigger>
                            <i:DataTrigger Binding="{Binding ActionReplaceValue.Value}" Comparison="Equal" Value="false">
                                <i:ChangePropertyAction TargetName="dstReplace" PropertyName="Visibility" Value="Hidden" />
                                <i:ChangePropertyAction TargetName="dstMask" PropertyName="Visibility" Value="Visible" />
                            </i:DataTrigger>
                        </i:Interaction.Triggers>
                    </RadioButton>
                </StackPanel>
            </GroupBox>

            <GroupBox
                Grid.Column="0" Grid.ColumnSpan="3" Grid.Row="2"
                Header="検索条件">
                <StackPanel Margin="8">
                    <RadioButton
                    IsChecked="{Binding RuleWordValue.Value, Mode=TwoWay}"
                    Content="単語一致検索"
                    GroupName="b"
                    />
                    <RadioButton
                    IsChecked="{Binding RuleWordAllValue.Value, Mode=TwoWay}"
                    Content="全文一致検索"
                    GroupName="b"
                    />
                    <RadioButton
                    IsChecked="{Binding RuleRegexValue.Value, Mode=TwoWay}"
                    Content="正規表現検索"
                    GroupName="b"
                    />
                </StackPanel>
            </GroupBox>

            <TextBlock
                Grid.Column="0" Grid.Row="4"
                Text="検索文字"
                />
            <TextBox
                Grid.Column="2" Grid.Row="4"                
                Text="{Binding Src.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                />
            <TextBlock
                Grid.Column="3" Grid.Row="4"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Foreground="Red"
                FontFamily="{StaticResource SymbolFont}" 
                Text="{StaticResource FontSymbolError}"
                Visibility="{Binding SrcErrorVisibility.Value, Mode=OneWay}"
                />

            <TextBlock
                Grid.Column="0" Grid.Row="6"
                Text="マスク/置き換え文字"
                />
            <TextBox
                x:Name="dstReplace"
                Grid.Column="2" Grid.Row="6"
                Text="{Binding DstReplace.Value, Mode=TwoWay}"
                AcceptsReturn="False"
                TextWrapping="Wrap"
                HorizontalScrollBarVisibility="Disabled"
                VerticalScrollBarVisibility="Visible"
                />
            <TextBox
                x:Name="dstMask"
                Grid.Column="2" Grid.Row="6"
                Text="{Binding DstMask.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                AcceptsReturn="False"
                TextWrapping="Wrap"
                HorizontalScrollBarVisibility="Disabled"
                VerticalScrollBarVisibility="Visible"
                />
            <TextBlock
                Grid.Column="3" Grid.Row="6"
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Foreground="Red"
                FontFamily="{StaticResource SymbolFont}" 
                Text="{StaticResource FontSymbolError}"
                Visibility="{Binding DstErrorVisibility.Value, Mode=OneWay}"
                />

            <Grid
                Grid.Column="0" Grid.ColumnSpan="4" Grid.Row="8"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="64" />
                    <ColumnDefinition Width="4" />
                    <ColumnDefinition Width="64" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="32" />
                </Grid.RowDefinitions>

                <Button
                    Grid.Column="0"
                    IsEnabled="{Binding OkButtonEnabled.Value, Mode=OneWay}"
                    Content="OK">
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="Click">
                            <ri:EventToReactiveCommand Command="{Binding OkClickCommand, Mode=OneWay}" />
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </Button>
                <Button
                    Grid.Column="2"
                    Content="キャンセル">
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="Click">
                            <ri:EventToReactiveCommand Command="{Binding CancelClickCommand, Mode=OneWay}" />
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </Button>
            </Grid>
        </Grid>
    </Border>
</UserControl>
